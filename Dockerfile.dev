# Development Dockerfile
# Based on ADR-014: Development Workflow and Local Setup
# Uses Ubuntu with Conan 2.x and GCC 12+

FROM ubuntu:22.04

# Install build tools and dependencies
RUN apt-get update && \
    apt-get install -y \
    build-essential \
    gcc-12 \
    g++-12 \
    cmake \
    ninja-build \
    git \
    python3 \
    python3-pip \
    postgresql-client \
    curl \
    && rm -rf /var/lib/apt/lists/*

# Set GCC 12 as default
RUN update-alternatives --install /usr/bin/gcc gcc /usr/bin/gcc-12 100 && \
    update-alternatives --install /usr/bin/g++ g++ /usr/bin/g++-12 100

# Install Conan 2.x
RUN pip3 install --no-cache-dir conan==2.*

# Set working directory
WORKDIR /app

# Copy Conan configuration
COPY conanfile.txt ./

# Install Conan dependencies
# Set C++20 standard during install
RUN conan profile detect --force && \
    conan install . --output-folder=build --build=missing -s compiler.cppstd=20

# Copy source code (will be overridden by volume mount, but needed for initial build)
COPY . .

# Note: Actual build will happen in container with mounted source
# This step is optional - we can build inside the container
# RUN cmake -S . -B build \
#     -DCMAKE_TOOLCHAIN_FILE=build/conan_toolchain.cmake \
#     -DCMAKE_BUILD_TYPE=Debug && \
#     cmake --build build

# Default command (can be overridden in docker-compose)
CMD ["/bin/bash"]

